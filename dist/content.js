(()=>{var Le=Object.create;var ve=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,ke=Object.prototype.hasOwnProperty;var re=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Ie=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of De(e))!ke.call(i,n)&&n!==t&&ve(i,n,{get:()=>e[n],enumerable:!(r=Pe(e,n))||r.enumerable});return i};var We=(i,e,t)=>(t=i!=null?Le(Re(i)):{},Ie(e||!i||!i.__esModule?ve(t,"default",{value:i,enumerable:!0}):t,i));var _e=re((Ue,ie)=>{function Se(i,e){if(e&&e.documentElement)i=e,e=arguments[2];else if(!i||!i.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(e=e||{},this._doc=i,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._metadata={},this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._keepClasses=!!e.keepClasses,this._serializer=e.serializer||function(t){return t.innerHTML},this._disableJSONLD=!!e.disableJSONLD,this._allowedVideoRegex=e.allowedVideoRegex||this.REGEXPS.videos,this._linkDensityModifier=e.linkDensityModifier||0,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let t=function(r){if(r.nodeType==r.TEXT_NODE)return`${r.nodeName} ("${r.textContent}")`;let n=Array.from(r.attributes||[],function(s){return`${s.name}="${s.value}"`}).join(" ");return`<${r.localName} ${n}>`};this.log=function(){if(typeof console<"u"){let n=Array.from(arguments,s=>s&&s.nodeType==this.ELEMENT_NODE?t(s):s);n.unshift("Reader: (Readability)"),console.log(...n)}else if(typeof dump<"u"){var r=Array.prototype.map.call(arguments,function(n){return n&&n.nodeName?t(n):n}).join(" ");dump("Reader: (Readability) "+r+`
`)}}}else this.log=function(){}}Se.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|footer|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/,adWords:/^(ad(vertising|vertisement)?|pub(licité)?|werb(ung)?|广告|Реклама|Anuncio)$/iu,loadingWords:/^((loading|正在加载|Загрузка|chargement|cargando)(…|\.\.\.)?)$/iu},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P","OL","UL"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent(i){this._fixRelativeUris(i),this._simplifyNestedElements(i),this._keepClasses||this._cleanClasses(i)},_removeNodes(i,e){if(this._docJSDOMParser&&i._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var t=i.length-1;t>=0;t--){var r=i[t],n=r.parentNode;n&&(!e||e.call(this,r,t,i))&&n.removeChild(r)}},_replaceNodeTags(i,e){if(this._docJSDOMParser&&i._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(let t of i)this._setNodeTag(t,e)},_forEachNode(i,e){Array.prototype.forEach.call(i,e,this)},_findNode(i,e){return Array.prototype.find.call(i,e,this)},_someNode(i,e){return Array.prototype.some.call(i,e,this)},_everyNode(i,e){return Array.prototype.every.call(i,e,this)},_getAllNodesWithTag(i,e){return i.querySelectorAll?i.querySelectorAll(e.join(",")):[].concat.apply([],e.map(function(t){var r=i.getElementsByTagName(t);return Array.isArray(r)?r:Array.from(r)}))},_cleanClasses(i){var e=this._classesToPreserve,t=(i.getAttribute("class")||"").split(/\s+/).filter(r=>e.includes(r)).join(" ");for(t?i.setAttribute("class",t):i.removeAttribute("class"),i=i.firstElementChild;i;i=i.nextElementSibling)this._cleanClasses(i)},_isUrl(i){try{return new URL(i),!0}catch{return!1}},_fixRelativeUris(i){var e=this._doc.baseURI,t=this._doc.documentURI;function r(a){if(e==t&&a.charAt(0)=="#")return a;try{return new URL(a,e).href}catch{}return a}var n=this._getAllNodesWithTag(i,["a"]);this._forEachNode(n,function(a){var o=a.getAttribute("href");if(o)if(o.indexOf("javascript:")===0)if(a.childNodes.length===1&&a.childNodes[0].nodeType===this.TEXT_NODE){var l=this._doc.createTextNode(a.textContent);a.parentNode.replaceChild(l,a)}else{for(var c=this._doc.createElement("span");a.firstChild;)c.appendChild(a.firstChild);a.parentNode.replaceChild(c,a)}else a.setAttribute("href",r(o))});var s=this._getAllNodesWithTag(i,["img","picture","figure","video","audio","source"]);this._forEachNode(s,function(a){var o=a.getAttribute("src"),l=a.getAttribute("poster"),c=a.getAttribute("srcset");if(o&&a.setAttribute("src",r(o)),l&&a.setAttribute("poster",r(l)),c){var u=c.replace(this.REGEXPS.srcsetUrl,function(g,h,b,N){return r(h)+(b||"")+N});a.setAttribute("srcset",u)}})},_simplifyNestedElements(i){for(var e=i;e;){if(e.parentNode&&["DIV","SECTION"].includes(e.tagName)&&!(e.id&&e.id.startsWith("readability"))){if(this._isElementWithoutContent(e)){e=this._removeAndGetNext(e);continue}else if(this._hasSingleTagInsideElement(e,"DIV")||this._hasSingleTagInsideElement(e,"SECTION")){for(var t=e.children[0],r=0;r<e.attributes.length;r++)t.setAttributeNode(e.attributes[r].cloneNode());e.parentNode.replaceChild(t,e),e=t;continue}}e=this._getNextNode(e)}},_getArticleTitle(){var i=this._doc,e="",t="";try{e=t=i.title.trim(),typeof e!="string"&&(e=t=this._getInnerText(i.getElementsByTagName("title")[0]))}catch{}var r=!1;function n(u){return u.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(e)){r=/ [\\\/>»] /.test(e);let u=Array.from(t.matchAll(/ [\|\-\\\/>»] /gi));e=t.substring(0,u.pop().index),n(e)<3&&(e=t.replace(/^[^\|\-\\\/>»]*[\|\-\\\/>»]/gi,""))}else if(e.includes(": ")){var s=this._getAllNodesWithTag(i,["h1","h2"]),a=e.trim(),o=this._someNode(s,function(u){return u.textContent.trim()===a});o||(e=t.substring(t.lastIndexOf(":")+1),n(e)<3?e=t.substring(t.indexOf(":")+1):n(t.substr(0,t.indexOf(":")))>5&&(e=t))}else if(e.length>150||e.length<15){var l=i.getElementsByTagName("h1");l.length===1&&(e=this._getInnerText(l[0]))}e=e.trim().replace(this.REGEXPS.normalize," ");var c=n(e);return c<=4&&(!r||c!=n(t.replace(/[\|\-\\\/>»]+/g,""))-1)&&(e=t),e},_prepDocument(){var i=this._doc;this._removeNodes(this._getAllNodesWithTag(i,["style"])),i.body&&this._replaceBrs(i.body),this._replaceNodeTags(this._getAllNodesWithTag(i,["font"]),"SPAN")},_nextNode(i){for(var e=i;e&&e.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs(i){this._forEachNode(this._getAllNodesWithTag(i,["br"]),function(e){for(var t=e.nextSibling,r=!1;(t=this._nextNode(t))&&t.tagName=="BR";){r=!0;var n=t.nextSibling;t.remove(),t=n}if(r){var s=this._doc.createElement("p");for(e.parentNode.replaceChild(s,e),t=s.nextSibling;t;){if(t.tagName=="BR"){var a=this._nextNode(t.nextSibling);if(a&&a.tagName=="BR")break}if(!this._isPhrasingContent(t))break;var o=t.nextSibling;s.appendChild(t),t=o}for(;s.lastChild&&this._isWhitespace(s.lastChild);)s.lastChild.remove();s.parentNode.tagName==="P"&&this._setNodeTag(s.parentNode,"DIV")}})},_setNodeTag(i,e){if(this.log("_setNodeTag",i,e),this._docJSDOMParser)return i.localName=e.toLowerCase(),i.tagName=e.toUpperCase(),i;for(var t=i.ownerDocument.createElement(e);i.firstChild;)t.appendChild(i.firstChild);i.parentNode.replaceChild(t,i),i.readability&&(t.readability=i.readability);for(var r=0;r<i.attributes.length;r++)t.setAttributeNode(i.attributes[r].cloneNode());return t},_prepArticle(i){this._cleanStyles(i),this._markDataTables(i),this._fixLazyImages(i),this._cleanConditionally(i,"form"),this._cleanConditionally(i,"fieldset"),this._clean(i,"object"),this._clean(i,"embed"),this._clean(i,"footer"),this._clean(i,"link"),this._clean(i,"aside");var e=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(i.children,function(t){this._cleanMatchedNodes(t,function(r,n){return this.REGEXPS.shareElements.test(n)&&r.textContent.length<e})}),this._clean(i,"iframe"),this._clean(i,"input"),this._clean(i,"textarea"),this._clean(i,"select"),this._clean(i,"button"),this._cleanHeaders(i),this._cleanConditionally(i,"table"),this._cleanConditionally(i,"ul"),this._cleanConditionally(i,"div"),this._replaceNodeTags(this._getAllNodesWithTag(i,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(i,["p"]),function(t){var r=this._getAllNodesWithTag(t,["img","embed","object","iframe"]).length;return r===0&&!this._getInnerText(t,!1)}),this._forEachNode(this._getAllNodesWithTag(i,["br"]),function(t){var r=this._nextNode(t.nextSibling);r&&r.tagName=="P"&&t.remove()}),this._forEachNode(this._getAllNodesWithTag(i,["table"]),function(t){var r=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(r,"TR")){var n=r.firstElementChild;if(this._hasSingleTagInsideElement(n,"TD")){var s=n.firstElementChild;s=this._setNodeTag(s,this._everyNode(s.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(s,t)}}})},_initializeNode(i){switch(i.readability={contentScore:0},i.tagName){case"DIV":i.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":i.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":i.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":i.readability.contentScore-=5;break}i.readability.contentScore+=this._getClassWeight(i)},_removeAndGetNext(i){var e=this._getNextNode(i,!0);return i.remove(),e},_getNextNode(i,e){if(!e&&i.firstElementChild)return i.firstElementChild;if(i.nextElementSibling)return i.nextElementSibling;do i=i.parentNode;while(i&&!i.nextElementSibling);return i&&i.nextElementSibling},_textSimilarity(i,e){var t=i.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),r=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!t.length||!r.length)return 0;var n=r.filter(a=>!t.includes(a)),s=n.join(" ").length/r.join(" ").length;return 1-s},_isValidByline(i,e){var t=i.getAttribute("rel"),r=i.getAttribute("itemprop"),n=i.textContent.trim().length;return(t==="author"||r&&r.includes("author")||this.REGEXPS.byline.test(e))&&!!n&&n<100},_getNodeAncestors(i,e){e=e||0;for(var t=0,r=[];i.parentNode&&(r.push(i.parentNode),!(e&&++t===e));)i=i.parentNode;return r},_grabArticle(i){this.log("**** grabArticle ****");var e=this._doc,t=i!==null;if(i=i||this._doc.body,!i)return this.log("No body found in document. Abort."),null;for(var r=i.innerHTML;;){this.log("Starting grabArticle loop");var n=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),s=[],a=this._doc.documentElement;let pe=!0;for(;a;){a.tagName==="HTML"&&(this._articleLang=a.getAttribute("lang"));var o=a.className+" "+a.id;if(!this._isProbablyVisible(a)){this.log("Removing hidden node - "+o),a=this._removeAndGetNext(a);continue}if(a.getAttribute("aria-modal")=="true"&&a.getAttribute("role")=="dialog"){a=this._removeAndGetNext(a);continue}if(!this._articleByline&&!this._metadata.byline&&this._isValidByline(a,o)){for(var l=this._getNextNode(a,!0),c=this._getNextNode(a),u=null;c&&c!=l;){var g=c.getAttribute("itemprop");if(g&&g.includes("name")){u=c;break}else c=this._getNextNode(c)}this._articleByline=(u??a).textContent.trim(),a=this._removeAndGetNext(a);continue}if(pe&&this._headerDuplicatesTitle(a)){this.log("Removing header: ",a.textContent.trim(),this._articleTitle.trim()),pe=!1,a=this._removeAndGetNext(a);continue}if(n){if(this.REGEXPS.unlikelyCandidates.test(o)&&!this.REGEXPS.okMaybeItsACandidate.test(o)&&!this._hasAncestorTag(a,"table")&&!this._hasAncestorTag(a,"code")&&a.tagName!=="BODY"&&a.tagName!=="A"){this.log("Removing unlikely candidate - "+o),a=this._removeAndGetNext(a);continue}if(this.UNLIKELY_ROLES.includes(a.getAttribute("role"))){this.log("Removing content with role "+a.getAttribute("role")+" - "+o),a=this._removeAndGetNext(a);continue}}if((a.tagName==="DIV"||a.tagName==="SECTION"||a.tagName==="HEADER"||a.tagName==="H1"||a.tagName==="H2"||a.tagName==="H3"||a.tagName==="H4"||a.tagName==="H5"||a.tagName==="H6")&&this._isElementWithoutContent(a)){a=this._removeAndGetNext(a);continue}if(this.DEFAULT_TAGS_TO_SCORE.includes(a.tagName)&&s.push(a),a.tagName==="DIV"){for(var h=null,b=a.firstChild;b;){var N=b.nextSibling;if(this._isPhrasingContent(b))h!==null?h.appendChild(b):this._isWhitespace(b)||(h=e.createElement("p"),a.replaceChild(h,b),h.appendChild(b));else if(h!==null){for(;h.lastChild&&this._isWhitespace(h.lastChild);)h.lastChild.remove();h=null}b=N}if(this._hasSingleTagInsideElement(a,"P")&&this._getLinkDensity(a)<.25){var E=a.children[0];a.parentNode.replaceChild(E,a),a=E,s.push(a)}else this._hasChildBlockElement(a)||(a=this._setNodeTag(a,"P"),s.push(a))}a=this._getNextNode(a)}var x=[];this._forEachNode(s,function(C){if(!(!C.parentNode||typeof C.parentNode.tagName>"u")){var L=this._getInnerText(C);if(!(L.length<25)){var ye=this._getNodeAncestors(C,5);if(ye.length!==0){var H=0;H+=1,H+=L.split(this.REGEXPS.commas).length,H+=Math.min(Math.floor(L.length/100),3),this._forEachNode(ye,function(D,ee){if(!(!D.tagName||!D.parentNode||typeof D.parentNode.tagName>"u")){if(typeof D.readability>"u"&&(this._initializeNode(D),x.push(D)),ee===0)var te=1;else ee===1?te=2:te=ee*3;D.readability.contentScore+=H/te}})}}}});for(var S=[],M=0,P=x.length;M<P;M+=1){var _=x[M],m=_.readability.contentScore*(1-this._getLinkDensity(_));_.readability.contentScore=m,this.log("Candidate:",_,"with score "+m);for(var p=0;p<this._nbTopCandidates;p++){var k=S[p];if(!k||m>k.readability.contentScore){S.splice(p,0,_),S.length>this._nbTopCandidates&&S.pop();break}}}var d=S[0]||null,R=!1,f;if(d===null||d.tagName==="BODY"){for(d=e.createElement("DIV"),R=!0;i.firstChild;)this.log("Moving child out:",i.firstChild),d.appendChild(i.firstChild);i.appendChild(d),this._initializeNode(d)}else if(d){for(var v=[],I=1;I<S.length;I++)S[I].readability.contentScore/d.readability.contentScore>=.75&&v.push(this._getNodeAncestors(S[I]));var z=3;if(v.length>=z)for(f=d.parentNode;f.tagName!=="BODY";){for(var Y=0,K=0;K<v.length&&Y<z;K++)Y+=Number(v[K].includes(f));if(Y>=z){d=f;break}f=f.parentNode}d.readability||this._initializeNode(d),f=d.parentNode;for(var J=d.readability.contentScore,we=J/3;f.tagName!=="BODY";){if(!f.readability){f=f.parentNode;continue}var he=f.readability.contentScore;if(he<we)break;if(he>J){d=f;break}J=f.readability.contentScore,f=f.parentNode}for(f=d.parentNode;f.tagName!="BODY"&&f.children.length==1;)d=f,f=d.parentNode;d.readability||this._initializeNode(d)}var T=e.createElement("DIV");t&&(T.id="readability-content");var Me=Math.max(10,d.readability.contentScore*.2);f=d.parentNode;for(var q=f.children,G=0,ge=q.length;G<ge;G++){var y=q[G],W=!1;if(this.log("Looking at sibling node:",y,y.readability?"with score "+y.readability.contentScore:""),this.log("Sibling has score",y.readability?y.readability.contentScore:"Unknown"),y===d)W=!0;else{var de=0;if(y.className===d.className&&d.className!==""&&(de+=d.readability.contentScore*.2),y.readability&&y.readability.contentScore+de>=Me)W=!0;else if(y.nodeName==="P"){var fe=this._getLinkDensity(y),me=this._getInnerText(y),Z=me.length;(Z>80&&fe<.25||Z<80&&Z>0&&fe===0&&me.search(/\.( |$)/)!==-1)&&(W=!0)}}W&&(this.log("Appending node:",y),this.ALTER_TO_DIV_EXCEPTIONS.includes(y.nodeName)||(this.log("Altering sibling:",y,"to div."),y=this._setNodeTag(y,"DIV")),T.appendChild(y),q=f.children,G-=1,ge-=1)}if(this._debug&&this.log("Article content pre-prep: "+T.innerHTML),this._prepArticle(T),this._debug&&this.log("Article content post-prep: "+T.innerHTML),R)d.id="readability-page-1",d.className="page";else{var F=e.createElement("DIV");for(F.id="readability-page-1",F.className="page";T.firstChild;)F.appendChild(T.firstChild);T.appendChild(F)}this._debug&&this.log("Article content after paging: "+T.innerHTML);var Q=!0,be=this._getInnerText(T,!0).length;if(be<this._charThreshold)if(Q=!1,i.innerHTML=r,this._attempts.push({articleContent:T,textLength:be}),this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS);else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES);else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);else{if(this._attempts.sort(function(C,L){return L.textLength-C.textLength}),!this._attempts[0].textLength)return null;T=this._attempts[0].articleContent,Q=!0}if(Q){var Ce=[f,d].concat(this._getNodeAncestors(f));return this._someNode(Ce,function(C){if(!C.tagName)return!1;var L=C.getAttribute("dir");return L?(this._articleDir=L,!0):!1}),T}}},_unescapeHtmlEntities(i){if(!i)return i;var e=this.HTML_ESCAPE_MAP;return i.replace(/&(quot|amp|apos|lt|gt);/g,function(t,r){return e[r]}).replace(/&#(?:x([0-9a-f]+)|([0-9]+));/gi,function(t,r,n){var s=parseInt(r||n,r?16:10);return(s==0||s>1114111||s>=55296&&s<=57343)&&(s=65533),String.fromCodePoint(s)})},_getJSONLD(i){var e=this._getAllNodesWithTag(i,["script"]),t;return this._forEachNode(e,function(r){if(!t&&r.getAttribute("type")==="application/ld+json")try{var n=r.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),s=JSON.parse(n);if(Array.isArray(s)&&(s=s.find(g=>g["@type"]&&g["@type"].match(this.REGEXPS.jsonLdArticleTypes)),!s))return;var a=/^https?\:\/\/schema\.org\/?$/,o=typeof s["@context"]=="string"&&s["@context"].match(a)||typeof s["@context"]=="object"&&typeof s["@context"]["@vocab"]=="string"&&s["@context"]["@vocab"].match(a);if(!o||(!s["@type"]&&Array.isArray(s["@graph"])&&(s=s["@graph"].find(g=>(g["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes))),!s||!s["@type"]||!s["@type"].match(this.REGEXPS.jsonLdArticleTypes)))return;if(t={},typeof s.name=="string"&&typeof s.headline=="string"&&s.name!==s.headline){var l=this._getArticleTitle(),c=this._textSimilarity(s.name,l)>.75,u=this._textSimilarity(s.headline,l)>.75;u&&!c?t.title=s.headline:t.title=s.name}else typeof s.name=="string"?t.title=s.name.trim():typeof s.headline=="string"&&(t.title=s.headline.trim());s.author&&(typeof s.author.name=="string"?t.byline=s.author.name.trim():Array.isArray(s.author)&&s.author[0]&&typeof s.author[0].name=="string"&&(t.byline=s.author.filter(function(g){return g&&typeof g.name=="string"}).map(function(g){return g.name.trim()}).join(", "))),typeof s.description=="string"&&(t.excerpt=s.description.trim()),s.publisher&&typeof s.publisher.name=="string"&&(t.siteName=s.publisher.name.trim()),typeof s.datePublished=="string"&&(t.datePublished=s.datePublished.trim())}catch(g){this.log(g.message)}}),t||{}},_getArticleMetadata(i){var e={},t={},r=this._doc.getElementsByTagName("meta"),n=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,s=/^\s*(?:(dc|dcterm|og|twitter|parsely|weibo:(article|webpage))\s*[-\.:]\s*)?(author|creator|pub-date|description|title|site_name)\s*$/i;this._forEachNode(r,function(o){var l=o.getAttribute("name"),c=o.getAttribute("property"),u=o.getAttribute("content");if(u){var g=null,h=null;c&&(g=c.match(n),g&&(h=g[0].toLowerCase().replace(/\s/g,""),t[h]=u.trim())),!g&&l&&s.test(l)&&(h=l,u&&(h=h.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),t[h]=u.trim()))}}),e.title=i.title||t["dc:title"]||t["dcterm:title"]||t["og:title"]||t["weibo:article:title"]||t["weibo:webpage:title"]||t.title||t["twitter:title"]||t["parsely-title"],e.title||(e.title=this._getArticleTitle());let a=typeof t["article:author"]=="string"&&!this._isUrl(t["article:author"])?t["article:author"]:void 0;return e.byline=i.byline||t["dc:creator"]||t["dcterm:creator"]||t.author||t["parsely-author"]||a,e.excerpt=i.excerpt||t["dc:description"]||t["dcterm:description"]||t["og:description"]||t["weibo:article:description"]||t["weibo:webpage:description"]||t.description||t["twitter:description"],e.siteName=i.siteName||t["og:site_name"],e.publishedTime=i.datePublished||t["article:published_time"]||t["parsely-pub-date"]||null,e.title=this._unescapeHtmlEntities(e.title),e.byline=this._unescapeHtmlEntities(e.byline),e.excerpt=this._unescapeHtmlEntities(e.excerpt),e.siteName=this._unescapeHtmlEntities(e.siteName),e.publishedTime=this._unescapeHtmlEntities(e.publishedTime),e},_isSingleImage(i){for(;i;){if(i.tagName==="IMG")return!0;if(i.children.length!==1||i.textContent.trim()!=="")return!1;i=i.children[0]}return!1},_unwrapNoscriptImages(i){var e=Array.from(i.getElementsByTagName("img"));this._forEachNode(e,function(r){for(var n=0;n<r.attributes.length;n++){var s=r.attributes[n];switch(s.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(s.value))return}r.remove()});var t=Array.from(i.getElementsByTagName("noscript"));this._forEachNode(t,function(r){if(this._isSingleImage(r)){var n=i.createElement("div");n.innerHTML=r.innerHTML;var s=r.previousElementSibling;if(s&&this._isSingleImage(s)){var a=s;a.tagName!=="IMG"&&(a=s.getElementsByTagName("img")[0]);for(var o=n.getElementsByTagName("img")[0],l=0;l<a.attributes.length;l++){var c=a.attributes[l];if(c.value!==""&&(c.name==="src"||c.name==="srcset"||/\.(jpg|jpeg|png|webp)/i.test(c.value))){if(o.getAttribute(c.name)===c.value)continue;var u=c.name;o.hasAttribute(u)&&(u="data-old-"+u),o.setAttribute(u,c.value)}}r.parentNode.replaceChild(n.firstElementChild,s)}}})},_removeScripts(i){this._removeNodes(this._getAllNodesWithTag(i,["script","noscript"]))},_hasSingleTagInsideElement(i,e){return i.children.length!=1||i.children[0].tagName!==e?!1:!this._someNode(i.childNodes,function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)})},_isElementWithoutContent(i){return i.nodeType===this.ELEMENT_NODE&&!i.textContent.trim().length&&(!i.children.length||i.children.length==i.getElementsByTagName("br").length+i.getElementsByTagName("hr").length)},_hasChildBlockElement(i){return this._someNode(i.childNodes,function(e){return this.DIV_TO_P_ELEMS.has(e.tagName)||this._hasChildBlockElement(e)})},_isPhrasingContent(i){return i.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.includes(i.tagName)||(i.tagName==="A"||i.tagName==="DEL"||i.tagName==="INS")&&this._everyNode(i.childNodes,this._isPhrasingContent)},_isWhitespace(i){return i.nodeType===this.TEXT_NODE&&i.textContent.trim().length===0||i.nodeType===this.ELEMENT_NODE&&i.tagName==="BR"},_getInnerText(i,e){e=typeof e>"u"?!0:e;var t=i.textContent.trim();return e?t.replace(this.REGEXPS.normalize," "):t},_getCharCount(i,e){return e=e||",",this._getInnerText(i).split(e).length-1},_cleanStyles(i){if(!(!i||i.tagName.toLowerCase()==="svg")){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)i.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.includes(i.tagName)&&(i.removeAttribute("width"),i.removeAttribute("height"));for(var t=i.firstElementChild;t!==null;)this._cleanStyles(t),t=t.nextElementSibling}},_getLinkDensity(i){var e=this._getInnerText(i).length;if(e===0)return 0;var t=0;return this._forEachNode(i.getElementsByTagName("a"),function(r){var n=r.getAttribute("href"),s=n&&this.REGEXPS.hashUrl.test(n)?.3:1;t+=this._getInnerText(r).length*s}),t/e},_getClassWeight(i){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0;return typeof i.className=="string"&&i.className!==""&&(this.REGEXPS.negative.test(i.className)&&(e-=25),this.REGEXPS.positive.test(i.className)&&(e+=25)),typeof i.id=="string"&&i.id!==""&&(this.REGEXPS.negative.test(i.id)&&(e-=25),this.REGEXPS.positive.test(i.id)&&(e+=25)),e},_clean(i,e){var t=["object","embed","iframe"].includes(e);this._removeNodes(this._getAllNodesWithTag(i,[e]),function(r){if(t){for(var n=0;n<r.attributes.length;n++)if(this._allowedVideoRegex.test(r.attributes[n].value))return!1;if(r.tagName==="object"&&this._allowedVideoRegex.test(r.innerHTML))return!1}return!0})},_hasAncestorTag(i,e,t,r){t=t||3,e=e.toUpperCase();for(var n=0;i.parentNode;){if(t>0&&n>t)return!1;if(i.parentNode.tagName===e&&(!r||r(i.parentNode)))return!0;i=i.parentNode,n++}return!1},_getRowAndColumnCount(i){for(var e=0,t=0,r=i.getElementsByTagName("tr"),n=0;n<r.length;n++){var s=r[n].getAttribute("rowspan")||0;s&&(s=parseInt(s,10)),e+=s||1;for(var a=0,o=r[n].getElementsByTagName("td"),l=0;l<o.length;l++){var c=o[l].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),a+=c||1}t=Math.max(t,a)}return{rows:e,columns:t}},_markDataTables(i){for(var e=i.getElementsByTagName("table"),t=0;t<e.length;t++){var r=e[t],n=r.getAttribute("role");if(n=="presentation"){r._readabilityDataTable=!1;continue}var s=r.getAttribute("datatable");if(s=="0"){r._readabilityDataTable=!1;continue}var a=r.getAttribute("summary");if(a){r._readabilityDataTable=!0;continue}var o=r.getElementsByTagName("caption")[0];if(o&&o.childNodes.length){r._readabilityDataTable=!0;continue}var l=["col","colgroup","tfoot","thead","th"],c=function(g){return!!r.getElementsByTagName(g)[0]};if(l.some(c)){this.log("Data table because found data-y descendant"),r._readabilityDataTable=!0;continue}if(r.getElementsByTagName("table")[0]){r._readabilityDataTable=!1;continue}var u=this._getRowAndColumnCount(r);if(u.columns==1||u.rows==1){r._readabilityDataTable=!1;continue}if(u.rows>=10||u.columns>4){r._readabilityDataTable=!0;continue}r._readabilityDataTable=u.rows*u.columns>10}},_fixLazyImages(i){this._forEachNode(this._getAllNodesWithTag(i,["img","picture","figure"]),function(e){if(e.src&&this.REGEXPS.b64DataUrl.test(e.src)){var t=this.REGEXPS.b64DataUrl.exec(e.src);if(t[1]==="image/svg+xml")return;for(var r=!1,n=0;n<e.attributes.length;n++){var s=e.attributes[n];if(s.name!=="src"&&/\.(jpg|jpeg|png|webp)/i.test(s.value)){r=!0;break}}if(r){var a=t[0].length,o=e.src.length-a;o<133&&e.removeAttribute("src")}}if(!((e.src||e.srcset&&e.srcset!="null")&&!e.className.toLowerCase().includes("lazy"))){for(var l=0;l<e.attributes.length;l++)if(s=e.attributes[l],!(s.name==="src"||s.name==="srcset"||s.name==="alt")){var c=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(s.value)?c="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(s.value)&&(c="src"),c){if(e.tagName==="IMG"||e.tagName==="PICTURE")e.setAttribute(c,s.value);else if(e.tagName==="FIGURE"&&!this._getAllNodesWithTag(e,["img","picture"]).length){var u=this._doc.createElement("img");u.setAttribute(c,s.value),e.appendChild(u)}}}}})},_getTextDensity(i,e){var t=this._getInnerText(i,!0).length;if(t===0)return 0;var r=0,n=this._getAllNodesWithTag(i,e);return this._forEachNode(n,s=>r+=this._getInnerText(s,!0).length),r/t},_cleanConditionally(i,e){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(i,[e]),function(t){var r=function(f){return f._readabilityDataTable},n=e==="ul"||e==="ol";if(!n){var s=0,a=this._getAllNodesWithTag(t,["ul","ol"]);this._forEachNode(a,f=>s+=this._getInnerText(f).length),n=s/this._getInnerText(t).length>.9}if(e==="table"&&r(t)||this._hasAncestorTag(t,"table",-1,r)||this._hasAncestorTag(t,"code")||[...t.getElementsByTagName("table")].some(f=>f._readabilityDataTable))return!1;var o=this._getClassWeight(t);this.log("Cleaning Conditionally",t);var l=0;if(o+l<0)return!0;if(this._getCharCount(t,",")<10){for(var c=t.getElementsByTagName("p").length,u=t.getElementsByTagName("img").length,g=t.getElementsByTagName("li").length-100,h=t.getElementsByTagName("input").length,b=this._getTextDensity(t,["h1","h2","h3","h4","h5","h6"]),N=0,E=this._getAllNodesWithTag(t,["object","embed","iframe"]),x=0;x<E.length;x++){for(var S=0;S<E[x].attributes.length;S++)if(this._allowedVideoRegex.test(E[x].attributes[S].value))return!1;if(E[x].tagName==="object"&&this._allowedVideoRegex.test(E[x].innerHTML))return!1;N++}var M=this._getInnerText(t);if(this.REGEXPS.adWords.test(M)||this.REGEXPS.loadingWords.test(M))return!0;var P=M.length,_=this._getLinkDensity(t),m=["SPAN","LI","TD"].concat(Array.from(this.DIV_TO_P_ELEMS)),p=this._getTextDensity(t,m),k=this._hasAncestorTag(t,"figure"),d=(()=>{let v=[];return!k&&u>1&&c/u<.5&&v.push(`Bad p to img ratio (img=${u}, p=${c})`),!n&&g>c&&v.push(`Too many li's outside of a list. (li=${g} > p=${c})`),h>Math.floor(c/3)&&v.push(`Too many inputs per p. (input=${h}, p=${c})`),!n&&!k&&b<.9&&P<25&&(u===0||u>2)&&_>0&&v.push(`Suspiciously short. (headingDensity=${b}, img=${u}, linkDensity=${_})`),!n&&o<25&&_>.2+this._linkDensityModifier&&v.push(`Low weight and a little linky. (linkDensity=${_})`),o>=25&&_>.5+this._linkDensityModifier&&v.push(`High weight and mostly links. (linkDensity=${_})`),(N===1&&P<75||N>1)&&v.push(`Suspicious embed. (embedCount=${N}, contentLength=${P})`),u===0&&p===0&&v.push(`No useful content. (img=${u}, textDensity=${p})`),v.length?(this.log("Checks failed",v),!0):!1})();if(n&&d){for(var R=0;R<t.children.length;R++)if(t.children[R].children.length>1)return d;let v=t.getElementsByTagName("li").length;if(u==v)return!1}return d}return!1})},_cleanMatchedNodes(i,e){for(var t=this._getNextNode(i,!0),r=this._getNextNode(i);r&&r!=t;)e.call(this,r,r.className+" "+r.id)?r=this._removeAndGetNext(r):r=this._getNextNode(r)},_cleanHeaders(i){let e=this._getAllNodesWithTag(i,["h1","h2"]);this._removeNodes(e,function(t){let r=this._getClassWeight(t)<0;return r&&this.log("Removing header with low class weight:",t),r})},_headerDuplicatesTitle(i){if(i.tagName!="H1"&&i.tagName!="H2")return!1;var e=this._getInnerText(i,!1);return this.log("Evaluating similarity of header:",e,this._articleTitle),this._textSimilarity(this._articleTitle,e)>.75},_flagIsActive(i){return(this._flags&i)>0},_removeFlag(i){this._flags=this._flags&~i},_isProbablyVisible(i){return(!i.style||i.style.display!="none")&&(!i.style||i.style.visibility!="hidden")&&!i.hasAttribute("hidden")&&(!i.hasAttribute("aria-hidden")||i.getAttribute("aria-hidden")!="true"||i.className&&i.className.includes&&i.className.includes("fallback-image"))},parse(){if(this._maxElemsToParse>0){var i=this._doc.getElementsByTagName("*").length;if(i>this._maxElemsToParse)throw new Error("Aborting parsing document; "+i+" elements found")}this._unwrapNoscriptImages(this._doc);var e=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var t=this._getArticleMetadata(e);this._metadata=t,this._articleTitle=t.title;var r=this._grabArticle();if(!r)return null;if(this.log("Grabbed: "+r.innerHTML),this._postProcessContent(r),!t.excerpt){var n=r.getElementsByTagName("p");n.length&&(t.excerpt=n[0].textContent.trim())}var s=r.textContent;return{title:this._articleTitle,byline:t.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(r),textContent:s,length:s.length,excerpt:t.excerpt,siteName:t.siteName||this._articleSiteName,publishedTime:t.publishedTime}}};typeof ie=="object"&&(ie.exports=Se)});var xe=re((Ve,se)=>{var Ee={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function Be(i){return(!i.style||i.style.display!="none")&&!i.hasAttribute("hidden")&&(!i.hasAttribute("aria-hidden")||i.getAttribute("aria-hidden")!="true"||i.className&&i.className.includes&&i.className.includes("fallback-image"))}function $e(i,e={}){typeof e=="function"&&(e={visibilityChecker:e});var t={minScore:20,minContentLength:140,visibilityChecker:Be};e=Object.assign(t,e);var r=i.querySelectorAll("p, pre, article"),n=i.querySelectorAll("div > br");if(n.length){var s=new Set(r);[].forEach.call(n,function(o){s.add(o.parentNode)}),r=Array.from(s)}var a=0;return[].some.call(r,function(o){if(!e.visibilityChecker(o))return!1;var l=o.className+" "+o.id;if(Ee.unlikelyCandidates.test(l)&&!Ee.okMaybeItsACandidate.test(l)||o.matches("li p"))return!1;var c=o.textContent.trim().length;return c<e.minContentLength?!1:(a+=Math.sqrt(c-e.minContentLength),a>e.minScore)})}typeof se=="object"&&(se.exports=$e)});var Ne=re((je,Te)=>{var Ge=_e(),Fe=xe();Te.exports={Readability:Ge,isProbablyReaderable:Fe}});var Ae=We(Ne(),1),ae=class{calculateIndex(e){let t=this.countWords(e),r=this.countSentences(e),n=this.countCharacters(e);if(t===0||r===0)return 0;let s=n/t*100,a=r/t*100,o=.0588*s-.296*a-15.8;return Math.round(o*10)/10}getComplexityClassification(e){return e<=6?"Simple":e<=9?"Easy":e<=12?"Moderate":e<=15?"Complex":"Very Complex"}getReadabilityLevel(e){return e<=6?"Elementary":e<=9?"Middle School":e<=12?"High School":e<=15?"College":"Graduate"}countWords(e){return e.trim().split(/\s+/).filter(r=>r.length>0).length}countSentences(e){let t=e.split(/[.!?]+/).filter(r=>r.trim().length>10);return Math.max(1,t.length)}countCharacters(e){let t=e.match(/[a-zA-Z0-9]/g);return t?t.length:0}},ne=class{constructor(){this.readabilityOptions={charThreshold:300,minContentLength:100,nbTopCandidates:3,wordThreshold:50,maxElemsToParse:500,linkDensityModifier:.2,debug:!1,classesToPreserve:["article-body","story-body","post-content","entry-content","article-content","main-content","text-content"]}}extractMainContent(){console.log("\u{1F680}\u{1F680}\u{1F680} EXTRACT MAIN CONTENT CALLED");try{let e=document.cloneNode(!0);if(e=this.preprocessSingleArticle(e),e=this.detectArticleBoundary(e),!e.querySelector("base")){let n=e.createElement("base");n.href=window.location.href,e.head?.appendChild(n)}let r=new Ae.Readability(e,this.readabilityOptions).parse();if(console.log("\u{1F50D}\u{1F50D}\u{1F50D} STARTING MOZILLA READABILITY DEBUG - THIS SHOULD APPEAR"),console.group("\u{1F50D} MOZILLA READABILITY DEBUG"),console.log("\u{1F4C4} Original Document Info:",{title:document.title,url:window.location.href,bodyLength:document.body.textContent?.length||0,articles:document.querySelectorAll("article").length,h1s:document.querySelectorAll("h1").length,mainElements:document.querySelectorAll("main").length}),r){let n=r.textContent.trim().split(/\s+/).filter(u=>u.length>0).length,s=r.textContent.split(/[.!?]+/).filter(u=>u.trim().length>0).length;console.log("\u2705 Mozilla Readability Results:",{title:r.title,excerpt:r.excerpt,length:r.length,contentLength:r.textContent.length,wordCount:n,sentences:s,siteName:r.siteName,byline:r.byline,dir:r.dir,lang:r.lang});let a=r.textContent.split(`
`).filter(u=>u.trim().length>0);console.log("\u{1F4CA} Content Structure:",{totalLines:a.length,avgWordsPerLine:n/Math.max(1,a.length),first5Lines:a.slice(0,5).map(u=>`"${u.trim().substring(0,80)}..."`),last5Lines:a.slice(-5).map(u=>`"${u.trim().substring(0,80)}..."`)});let o=r.textContent.split(/\n\n+/).filter(u=>u.trim().length>20);console.log("\u{1F4DD} Content Sections Preview:",{totalSections:o.length,sectionWordCounts:o.slice(0,10).map(u=>({words:u.trim().split(/\s+/).length,preview:`"${u.trim().substring(0,100)}..."`}))});let c=(document.body.textContent||"").trim().split(/\s+/).filter(u=>u.length>0).length;if(console.log("\u{1F4CA} Content Comparison:",{readabilityWords:n,bodyWords:c,extractionRatio:`${Math.round(n/c*100)}%`,difference:n-c}),console.groupEnd(),r.textContent&&r.textContent.trim().length>this.readabilityOptions.wordThreshold)return n>500?(console.warn(`\u26A0\uFE0F Large extraction detected (${n} words), applying content trimming`),this.trimToSingleArticle(r.textContent,r.title||this.extractFallbackTitle())):{text:r.textContent,title:r.title||this.extractFallbackTitle(),element:null};console.warn("\u26A0\uFE0F Article content below threshold, falling back")}else return console.warn("\u26A0\uFE0F Mozilla Readability failed, falling back to basic extraction"),this.extractFallbackContent()}catch(e){return console.error("\u274C Mozilla Readability error:",e),console.warn("\u26A0\uFE0F Falling back to basic content extraction"),this.extractFallbackContent()}}extractFallbackContent(){let e=["article","main",'[role="main"]',".article-body",".story-body",".post-content",".entry-content",".content",".main-content"],t=null,r=0;for(let a of e){let o=document.querySelectorAll(a);for(let l of o){let u=(l.textContent||"").trim().split(/\s+/).length;u>r&&u>=50&&(r=u,t=l)}}t||(t=document.body);let n=this.cleanFallbackText(t),s=this.extractFallbackTitle();return console.log(`\u{1F4DD} Fallback extraction:
      Element: ${t.tagName}${t.className?"."+t.className.split(" ")[0]:""}
      Word count: ${n.split(/\s+/).filter(a=>a.length>0).length}
      First 100 chars: "${n.substring(0,100)}..."
    `),{text:n,title:s,element:t}}cleanFallbackText(e){let t=e.textContent||"";return t=t.replace(/\s+/g," ").replace(/\n+/g," ").replace(/\t+/g," ").trim(),t}extractFallbackTitle(){let e=[()=>document.querySelector("h1")?.textContent,()=>document.querySelector('[role="heading"][aria-level="1"]')?.textContent,()=>document.querySelector(".article-title")?.textContent,()=>document.querySelector(".post-title")?.textContent,()=>document.querySelector(".entry-title")?.textContent,()=>document.title];for(let t of e){let r=t()?.trim();if(r&&r.length>0)return r}return"Untitled"}preprocessSingleArticle(e){console.log("\u{1F527} Pre-processing for single article extraction...");let t=e.querySelectorAll("article");if(t.length>1){console.log(`\u{1F4C4} Found ${t.length} articles, using first one`);let n=e.implementation.createHTMLDocument(),s=t[0].cloneNode(!0);return n.body.appendChild(s),e.head&&(n.head.innerHTML=e.head.innerHTML),n}let r=["main article","main",'[role="main"]',".article-body",".story-body",".post-content",".entry-content"];for(let n of r){let s=e.querySelector(n);if(s){let a=s.textContent?.length||0;if(a>200){console.log(`\u{1F4C4} Using main container: ${n} (${a} chars)`);let o=e.implementation.createHTMLDocument();return o.body.appendChild(s.cloneNode(!0)),e.head&&(o.head.innerHTML=e.head.innerHTML),o}}}return console.log("\u{1F4C4} No single article container found, using full document"),e}detectArticleBoundary(e){console.log("\u{1F3AF} Detecting article boundaries...");let t=e.querySelectorAll("article"),r=e.querySelectorAll("h1");if(t.length>1){console.log(`\u{1F3AF} Multiple articles detected (${t.length}), using first`);let n=e.implementation.createHTMLDocument();return n.body.appendChild(t[0].cloneNode(!0)),e.head&&(n.head.innerHTML=e.head.innerHTML),n}if(r.length>1){console.log(`\u{1F3AF} Multiple H1s detected (${r.length}), extracting up to second H1`);let n=r[0],s=r[1],a=n.parentElement;for(;a&&a!==e.body&&!(a.tagName.toLowerCase()==="article"||a.tagName.toLowerCase()==="main"||a.getAttribute("role")==="main");)a=a.parentElement;if(a&&a!==e.body){let o=e.implementation.createHTMLDocument(),l=o.createElement("div"),c=n;for(;c&&c!==s&&a.contains(c);)l.appendChild(c.cloneNode(!0)),c=this.getNextSibling(c,a);return o.body.appendChild(l),e.head&&(o.head.innerHTML=e.head.innerHTML),o}}return console.log("\u{1F3AF} No clear boundaries detected, using full document"),e}getNextSibling(e,t){let r=e.nextSibling;for(;!r&&e.parentNode&&e.parentNode!==t;)e=e.parentNode,r=e.nextSibling;return r&&t.contains(r)?r:null}trimToSingleArticle(e,t){console.log("\u2702\uFE0F Trimming over-extracted content...");let r=e.split(/\n\s*\n/).filter(l=>l.trim().length>20),n=350,s="",a=0;for(let l=0;l<r.length;l++){let c=r[l].trim(),u=c.split(/\s+/).length;if(a+u>n&&a>200){console.log(`\u2702\uFE0F Stopping at paragraph ${l}, word count: ${a}`);break}s+=c+`

`,a+=u}let o=s.trim().split(/\s+/).filter(l=>l.length>0).length;return console.log(`\u2702\uFE0F Trimmed from ${e.split(/\s+/).length} to ${o} words`),{text:s.trim(),title:t,element:null}}},oe=class{constructor(){this.unsuitableHostnames=["youtube.com","www.youtube.com","m.youtube.com","youtu.be","vimeo.com","dailymotion.com","twitch.tv","www.twitch.tv","netflix.com","hulu.com","disney.com","spotify.com","soundcloud.com","bandcamp.com","facebook.com","www.facebook.com","m.facebook.com","twitter.com","x.com","linkedin.com","instagram.com","tiktok.com","snapchat.com","reddit.com","www.reddit.com","discord.com","slack.com","teams.microsoft.com","whatsapp.com","telegram.org","signal.org"];this.unsuitablePatterns=["/admin","/dashboard","/wp-admin","/wp-login","/login","/signin","/signup","/register","/checkout","/cart","/payment","/billing"]}isPageSuitable(){let e=window.location.href.toLowerCase(),t=window.location.hostname.toLowerCase(),r=window.location.pathname.toLowerCase();if(e.startsWith("chrome-extension://")||e.startsWith("moz-extension://")||e.startsWith("ms-browser-extension://"))return console.log("\u{1F6AB} Skipping analysis - extension page detected"),!1;for(let n of this.unsuitableHostnames)if(t.includes(n))return console.log(`\u{1F6AB} Skipping analysis - unsuitable site: ${n}`),!1;for(let n of this.unsuitablePatterns)if(r.includes(n))return console.log(`\u{1F6AB} Skipping analysis - unsuitable page: ${n}`),!1;return this.hasMinimumContent()?!0:(console.log("\u{1F6AB} Skipping analysis - insufficient content"),!1)}hasMinimumContent(){let t=(document.body.textContent||"").trim().split(/\s+/).length,r=document.querySelectorAll("p").length;return t>=100&&r>=2}},O=class{constructor(){this.colemanLiau=new ae;this.extractor=new ne;this.suitabilityDetector=new oe;this.baseReadingSpeedWPM=225}async analyzeCurrentPage(e=this.baseReadingSpeedWPM){if(console.log("\u{1F4CA} Starting text analysis..."),!this.suitabilityDetector.isPageSuitable())return console.log("\u{1F6AB} Page not suitable for analysis"),null;let{text:t,title:r,element:n}=this.extractor.extractMainContent();if(!t||t.length<100)return console.log("\u{1F6AB} Insufficient text content for analysis"),null;let s=this.colemanLiau.calculateIndex(t),a=this.colemanLiau.getComplexityClassification(s),o=this.colemanLiau.getReadabilityLevel(s),l=t.trim().split(/\s+/).length,c=t.split(/[.!?]+/).filter(x=>x.trim().length>0).length,u=(t.match(/[a-zA-Z0-9]/g)||[]).length,g=Math.round(l/Math.max(1,c)*10)/10,h=Math.round(u/l*10)/10,b=e;s>15?b*=.8:s>12?b*=.9:s<6&&(b*=1.1);let N=Math.ceil(l/b),E={wordCount:l,readingTime:N,complexity:{averageSentenceLength:g,averageCharactersPerWord:h,complexityScore:a,readabilityLevel:o,colemanLiauIndex:s},url:window.location.href,title:r,timestamp:Date.now(),textContent:t};return console.log("\u2705 Analysis complete:",E),E}getMainContentElement(){let{element:e}=this.extractor.extractMainContent();return e}setReadingSpeed(e){this.baseReadingSpeedWPM=e,console.log(`\u{1F4D6} Reading speed updated to ${e} WPM`)}};var U=class{constructor(e={},t={}){this.isActive=!1;this.isPaused=!1;this.currentWordIndex=0;this.words=[];this.originalContent="";this.contentContainer=null;this.revealTimer=null;this.startTime=0;this.keyboardListener=null;this.config={wpm:225,highlightColor:"#4285f4",progressIndicator:!0,keyboardControls:!0,autoScroll:!0,...e},this.events=t}async startBlurMode(e){try{if(console.log("\u{1F3AF} Starting BlurMode..."),this.contentContainer=e||this.findMainContent(),!this.contentContainer)return console.error("\u274C No suitable content found for blur mode"),!1;this.originalContent=this.contentContainer.innerHTML;let t=this.processTextContent();return t===0?(console.error("\u274C No words found to process"),!1):(this.isActive=!0,this.isPaused=!1,this.currentWordIndex=0,this.startTime=Date.now(),this.config.keyboardControls&&this.setupKeyboardControls(),this.hideAllWords(),this.startRevealTimer(),console.log(`\u2705 BlurMode started: ${t} words at ${this.config.wpm} WPM`),this.events.onStart?.(),!0)}catch(t){return console.error("\u274C Failed to start blur mode:",t),!1}}stopBlurMode(){if(!this.isActive)return;console.log("\u23F9\uFE0F Stopping BlurMode..."),this.revealTimer&&(clearInterval(this.revealTimer),this.revealTimer=null),this.keyboardListener&&(document.removeEventListener("keydown",this.keyboardListener),this.keyboardListener=null),this.contentContainer&&this.originalContent&&(this.contentContainer.innerHTML=this.originalContent);let e=this.getStats();this.isActive=!1,this.isPaused=!1,this.currentWordIndex=0,this.words=[],console.log("\u2705 BlurMode stopped, content restored"),this.events.onStop?.(),this.events.onComplete?.(e)}togglePause(){this.isActive&&(this.isPaused?this.resumeBlurMode():this.pauseBlurMode())}pauseBlurMode(){this.revealTimer&&(clearInterval(this.revealTimer),this.revealTimer=null),this.isPaused=!0,console.log("\u23F8\uFE0F BlurMode paused"),this.events.onPause?.()}resumeBlurMode(){this.startRevealTimer(),this.isPaused=!1,console.log("\u25B6\uFE0F BlurMode resumed"),this.events.onResume?.()}adjustSpeed(e){this.config.wpm=Math.max(50,Math.min(800,e)),this.isActive&&!this.isPaused&&(this.revealTimer&&clearInterval(this.revealTimer),this.startRevealTimer()),console.log(`\u{1F39B}\uFE0F BlurMode speed adjusted to ${this.config.wpm} WPM`)}getStats(){let e=this.isActive?Date.now()-this.startTime:0,t=e>0?this.currentWordIndex/(e/6e4):0;return{wordsRevealed:this.currentWordIndex,totalWords:this.words.length,timeElapsed:e,currentWPM:Math.round(t),isActive:this.isActive,isPaused:this.isPaused}}findMainContent(){let e=["main","article",'[role="main"]',".main-content",".article-content",".post-content",".content","#content",'div[id*="content"]','div[class*="content"]'];for(let s of e){let a=document.querySelector(s);if(a&&a.textContent&&a.textContent.trim().length>100)return a}let t=document.querySelectorAll("div, section, article"),r=null,n=0;for(let s of t){let a=s.textContent?.trim()||"";a.length>n&&a.length>500&&(r=s,n=a.length)}return r}processTextContent(){if(!this.contentContainer)return 0;let e=document.createTreeWalker(this.contentContainer,NodeFilter.SHOW_TEXT,{acceptNode:s=>{let a=s.parentNode;if(!a)return NodeFilter.FILTER_REJECT;let o=a.tagName.toLowerCase();if(["script","style","noscript","code","pre"].includes(o))return NodeFilter.FILTER_REJECT;let l=s.textContent?.trim();return l&&l.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[],r;for(;r=e.nextNode();)t.push(r);let n=0;for(let s of t){let o=(s.textContent||"").split(/(\s+)/).filter(u=>u.trim().length>0);if(o.length===0)continue;let l=s.parentNode;if(!l)continue;let c=document.createDocumentFragment();for(let u=0;u<o.length;u++){let g=o[u];if(g.trim().length===0)continue;let h=document.createElement("span");h.textContent=g,h.className="blur-word",h.dataset.wordIndex=n.toString(),h.style.cssText=`
          visibility: hidden;
          transition: all 0.2s ease;
        `,c.appendChild(h),this.words.push(h),n++,u<o.length-1&&c.appendChild(document.createTextNode(" "))}l.replaceChild(c,s)}return this.words.length}hideAllWords(){this.words.forEach(e=>{e.style.visibility="hidden",e.style.backgroundColor="transparent"})}startRevealTimer(){let e=6e4/this.config.wpm;this.revealTimer=window.setInterval(()=>{this.revealNextWord()},e)}revealNextWord(){if(this.currentWordIndex>=this.words.length){this.stopBlurMode();return}if(this.currentWordIndex>0){let t=this.words[this.currentWordIndex-1];t.style.backgroundColor="transparent"}let e=this.words[this.currentWordIndex];e.style.visibility="visible",e.style.backgroundColor=this.config.highlightColor+"33",this.config.autoScroll&&e.scrollIntoView({behavior:"smooth",block:"center"}),this.events.onWordRevealed?.(this.currentWordIndex,e.textContent||""),this.currentWordIndex++}setupKeyboardControls(){this.keyboardListener=e=>{if(this.isActive)switch(e.code){case"Space":e.preventDefault(),this.togglePause();break;case"Escape":e.preventDefault(),this.stopBlurMode();break;case"ArrowRight":e.preventDefault(),this.isPaused&&this.currentWordIndex<this.words.length&&this.revealNextWord();break;case"ArrowLeft":e.preventDefault(),this.isPaused&&this.currentWordIndex>0&&(this.currentWordIndex=Math.max(0,this.currentWordIndex-2),this.hideWordsAfter(this.currentWordIndex),this.revealNextWord());break;case"KeyR":e.preventDefault(),this.restartBlurMode();break}},document.addEventListener("keydown",this.keyboardListener)}hideWordsAfter(e){for(let t=e;t<this.words.length;t++)this.words[t].style.visibility="hidden",this.words[t].style.backgroundColor="transparent"}restartBlurMode(){this.isActive&&(this.currentWordIndex=0,this.startTime=Date.now(),this.hideAllWords(),this.revealTimer&&clearInterval(this.revealTimer),this.isPaused||this.startRevealTimer(),console.log("\u{1F504} BlurMode restarted"))}isBlurModeActive(){return this.isActive}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}};var V=class{constructor(e={},t={},r){this.currentSession=null;this.goals={dailyWordGoal:2e3,weeklyGoalEnabled:!0,weeklyWordGoal:14e3,streakGoalEnabled:!0,targetStreakDays:7,...e},this.events=t,this.storageManager=r}async startSession(e,t,r=225){this.currentSession?.isActive&&await this.endSession();let n=this.generateSessionId();return this.currentSession={id:n,startTime:Date.now(),url:e,title:t,wordsRead:0,pagesAnalyzed:0,blurModeUsed:!1,completionRate:0,targetWPM:r,duration:0,isActive:!0},console.log("\u{1F680} Reading session started:",n),this.events.onSessionStart?.(this.currentSession),this.currentSession}async endSession(){if(!this.currentSession||!this.currentSession.isActive)return null;let e=Date.now();this.currentSession.endTime=e,this.currentSession.duration=e-this.currentSession.startTime,this.currentSession.isActive=!1,this.currentSession.blurModeWords&&this.currentSession.duration>0&&(this.currentSession.actualWPM=Math.round(this.currentSession.blurModeWords/(this.currentSession.duration/6e4))),await this.saveSession(this.currentSession);let t=await this.calculateStatistics();await this.updateDailyProgress(),await this.updateStreak(),console.log("\u23F9\uFE0F Reading session ended:",this.currentSession.id),this.events.onSessionEnd?.(this.currentSession,t);let r={...this.currentSession};return this.currentSession=null,r}updateSessionProgress(e){this.currentSession?.isActive&&(Object.assign(this.currentSession,e),this.currentSession.duration=Date.now()-this.currentSession.startTime,this.storageManager&&this.saveSession(this.currentSession))}getCurrentSession(){return this.currentSession}async calculateStatistics(){let e=await this.getAllSessions(),t=this.getTodayString(),r=this.getThisWeekDates(),n=e.length,s=e.reduce((m,p)=>m+p.wordsRead,0),a=e.reduce((m,p)=>m+p.duration,0),o=e.filter(m=>m.endTime),l=o.length>0?o.reduce((m,p)=>m+(p.actualWPM||p.targetWPM),0)/o.length:0,c=o.length>0?a/o.length:0,u=e.filter(m=>m.blurModeUsed).length,g=n>0?u/n*100:0,h={};e.forEach(m=>{m.avgComplexity&&(h[m.avgComplexity]=(h[m.avgComplexity]||0)+1)});let b=Object.keys(h).reduce((m,p)=>h[m]>h[p]?m:p,"Moderate"),{currentStreak:N,longestStreak:E}=await this.calculateStreaks(),S=e.filter(m=>this.getDateString(m.startTime)===t).reduce((m,p)=>m+p.wordsRead,0),M=Math.min(1,S/this.goals.dailyWordGoal),P=this.calculateWeeklyStats(e,r),_=this.calculateMonthlyStats(e);return{totalSessions:n,totalWordsRead:s,totalTimeSpent:a,averageWPM:Math.round(l),averageSessionLength:Math.round(c),blurModeUsage:Math.round(g),favoriteComplexity:b,currentStreak:N,longestStreak:E,dailyGoalProgress:M,weeklyStats:P,monthlyStats:_}}async getTodayProgress(){let e=await this.getAllSessions(),t=this.getTodayString(),r=e.filter(o=>this.getDateString(o.startTime)===t),n=r.reduce((o,l)=>o+l.wordsRead,0),s=r.reduce((o,l)=>o+l.duration,0),a=n>=this.goals.dailyWordGoal;return{date:t,wordsRead:n,sessionsCount:r.length,timeSpent:s,goalMet:a}}updateGoals(e){this.goals={...this.goals,...e},this.storageManager&&this.storageManager.save("reading_goals",this.goals)}getGoals(){return{...this.goals}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async saveSession(e){if(!this.storageManager)return;let t=await this.getAllSessions(),r=t.findIndex(n=>n.id===e.id);r>=0?t[r]=e:t.push(e),await this.storageManager.save("reading_sessions",t)}async getAllSessions(){if(!this.storageManager)return[];try{return await this.storageManager.get("reading_sessions")||[]}catch(e){return console.error("Failed to load sessions:",e),[]}}async calculateStreaks(){let e=await this.getAllSessions(),t=[...new Set(e.filter(l=>l.endTime).map(l=>this.getDateString(l.startTime)))].sort(),r=0,n=0,s=0,a=this.getTodayString(),o=this.getDateString(Date.now()-1440*60*1e3);for(let l=0;l<30;l++){let c=this.getDateString(Date.now()-l*24*60*60*1e3);if(t.includes(c)){if(l===0||l===1&&c===o)r++;else if(r===0)break}else{if(l===0&&t.includes(o))continue;if(r>0)break}}s=1;for(let l=1;l<t.length;l++){let c=new Date(t[l-1]);(new Date(t[l]).getTime()-c.getTime())/(1440*60*1e3)===1?s++:(n=Math.max(n,s),s=1)}return n=Math.max(n,s),{currentStreak:r,longestStreak:n}}async updateDailyProgress(){let e=await this.getTodayProgress();e.goalMet&&this.events.onGoalAchieved?.("daily"),this.events.onGoalProgress?.(e.wordsRead/this.goals.dailyWordGoal,"daily")}async updateStreak(){let{currentStreak:e,longestStreak:t}=await this.calculateStreaks(),r=e>t;this.events.onStreakUpdated?.(e,r),this.goals.streakGoalEnabled&&e>=this.goals.targetStreakDays&&this.events.onGoalAchieved?.("streak")}calculateWeeklyStats(e,t){return t.map(r=>{let n=e.filter(o=>this.getDateString(o.startTime)===r),s=n.reduce((o,l)=>o+l.wordsRead,0),a=n.reduce((o,l)=>o+l.duration,0);return{date:r,wordsRead:s,sessionsCount:n.length,timeSpent:a,goalMet:s>=this.goals.dailyWordGoal}})}calculateMonthlyStats(e){let t=this.getMonthString(),r=e.filter(c=>this.getMonthString(c.startTime)===t),n=r.reduce((c,u)=>c+u.wordsRead,0),s=r.reduce((c,u)=>c+u.duration,0),a=r.filter(c=>c.endTime),o=a.length>0?a.reduce((c,u)=>c+(u.actualWPM||u.targetWPM),0)/a.length:0,l=[...new Set(r.map(c=>this.getDateString(c.startTime)))];return{month:t,totalWords:n,totalSessions:r.length,totalTime:s,averageWPM:Math.round(o),streakDays:l.length}}getTodayString(){return this.getDateString(Date.now())}getDateString(e){return new Date(e).toISOString().split("T")[0]}getMonthString(e=Date.now()){return new Date(e).toISOString().substring(0,7)}getThisWeekDates(){let e=[],t=new Date,r=new Date(t);r.setDate(t.getDate()-t.getDay());for(let n=0;n<7;n++){let s=new Date(r);s.setDate(r.getDate()+n),e.push(this.getDateString(s.getTime()))}return e}async exportData(){let e=await this.getAllSessions(),t=await this.calculateStatistics();return{sessions:e,goals:this.goals,stats:t}}async importData(e){this.storageManager&&(e.sessions&&await this.storageManager.save("reading_sessions",e.sessions),e.goals&&(this.goals={...this.goals,...e.goals},await this.storageManager.save("reading_goals",this.goals)))}};var j=class{constructor(e={}){this.schemas=new Map;this.config={maxRetries:3,retryDelayMs:100,useExponentialBackoff:!0,enableFallback:!0,fallbackPrefix:"readwise_",validateData:!0,debugMode:!1,...e},this.config.debugMode&&console.log("\u{1F5C4}\uFE0F StorageManager initialized with config:",this.config)}async save(e,t,r=!1){if(!e||typeof e!="string")return{success:!1,error:"Invalid key: must be non-empty string"};if(this.config.validateData&&this.schemas.has(e)){let s=this.validateData(e,t);if(!s.isValid)return{success:!1,error:`Data validation failed: ${s.error}`}}this.config.debugMode&&console.log(`\u{1F4BE} Saving data to storage: ${e}`,t);let n=await this.attemptChromeStorage("save",e,t,r);if(n.success)return n;if(this.config.enableFallback){this.config.debugMode&&console.log(`\u{1F504} Chrome storage failed, trying localStorage fallback for: ${e}`);try{let s=this.config.fallbackPrefix+e,a=JSON.stringify(t);return localStorage.setItem(s,a),this.config.debugMode&&console.log(`\u2705 Successfully saved to localStorage: ${s}`),{success:!0,data:t,fromFallback:!0}}catch(s){return console.error("\u274C Both Chrome storage and localStorage failed:",s),{success:!1,error:`All storage methods failed. Chrome: ${n.error}, LocalStorage: ${s}`,fromFallback:!0}}}return n}async get(e,t,r=!1){if(!e||typeof e!="string")return{success:!1,error:"Invalid key: must be non-empty string"};this.config.debugMode&&console.log(`\u{1F4D6} Retrieving data from storage: ${e}`);let n=await this.attemptChromeStorage("get",e,void 0,r);if(n.success&&n.data!==void 0)if(this.config.validateData&&this.schemas.has(e)){let s=this.validateData(e,n.data);if(!s.isValid)console.warn(`\u26A0\uFE0F Retrieved data failed validation for key ${e}:`,s.error);else return n}else return n;if(this.config.enableFallback){this.config.debugMode&&console.log(`\u{1F504} Chrome storage failed/empty, trying localStorage fallback for: ${e}`);try{let s=this.config.fallbackPrefix+e,a=localStorage.getItem(s);if(a!==null){let o=JSON.parse(a);if(this.config.validateData&&this.schemas.has(e)){let l=this.validateData(e,o);if(!l.isValid)return console.warn(`\u26A0\uFE0F Fallback data failed validation for key ${e}:`,l.error),{success:!0,data:t,fromFallback:!0}}return this.config.debugMode&&console.log(`\u2705 Successfully retrieved from localStorage: ${s}`,o),{success:!0,data:o,fromFallback:!0}}}catch(s){console.error("\u274C localStorage fallback failed:",s)}}return t!==void 0?{success:!0,data:t,fromFallback:this.config.enableFallback}:{success:!1,error:`No data found for key: ${e}`,fromFallback:this.config.enableFallback}}async remove(e,t=!1){if(!e||typeof e!="string")return{success:!1,error:"Invalid key: must be non-empty string"};this.config.debugMode&&console.log(`\u{1F5D1}\uFE0F Removing data from storage: ${e}`);let r=!1,n=!1,s=[],a=await this.attemptChromeStorage("remove",e,void 0,t);if(a.success?r=!0:s.push(`Chrome storage: ${a.error}`),this.config.enableFallback)try{let o=this.config.fallbackPrefix+e;localStorage.removeItem(o),n=!0,this.config.debugMode&&console.log(`\u2705 Successfully removed from localStorage: ${o}`)}catch(o){s.push(`LocalStorage: ${o}`)}return r||n?{success:!0}:{success:!1,error:`Failed to remove from all storage methods: ${s.join(", ")}`}}async clear(e=!1){this.config.debugMode&&console.log("\u{1F9F9} Clearing all storage data");let t=!1,r=!1,n=[];try{this.isExtensionContextValid()&&(await(e?chrome.storage.local:chrome.storage.sync).clear(),t=!0,this.config.debugMode&&console.log("\u2705 Chrome storage cleared successfully"))}catch(s){n.push(`Chrome storage: ${s}`)}if(this.config.enableFallback)try{let s=[];for(let a=0;a<localStorage.length;a++){let o=localStorage.key(a);o&&o.startsWith(this.config.fallbackPrefix)&&s.push(o)}s.forEach(a=>localStorage.removeItem(a)),r=!0,this.config.debugMode&&console.log(`\u2705 Cleared ${s.length} localStorage fallback items`)}catch(s){n.push(`LocalStorage: ${s}`)}return t||r?{success:!0}:{success:!1,error:`Failed to clear storage: ${n.join(", ")}`}}async saveBatch(e,t=!1){if(!e||typeof e!="object")return{success:!1,error:"Invalid data: must be object with key-value pairs"};let r=Object.keys(e);if(r.length===0)return{success:!0};if(this.config.debugMode&&console.log(`\u{1F4E6} Batch saving ${r.length} items:`,r),this.config.validateData){let s=[];for(let a of r)if(this.schemas.has(a)){let o=this.validateData(a,e[a]);o.isValid||s.push(`${a}: ${o.error}`)}if(s.length>0)return{success:!1,error:`Batch validation failed: ${s.join(", ")}`}}let n=await this.attemptChromeStorage("saveBatch","",e,t);if(n.success)return n;if(this.config.enableFallback){this.config.debugMode&&console.log("\u{1F504} Batch Chrome storage failed, using localStorage fallback");let s=[],a=0;for(let[o,l]of Object.entries(e))try{let c=this.config.fallbackPrefix+o,u=JSON.stringify(l);localStorage.setItem(c,u),a++}catch(c){s.push(`${o}: ${c}`)}return a===r.length?(this.config.debugMode&&console.log(`\u2705 Batch localStorage fallback successful: ${a}/${r.length} items`),{success:!0,fromFallback:!0}):{success:!1,error:`Batch fallback partial failure: ${a}/${r.length} succeeded. Errors: ${s.join(", ")}`,fromFallback:!0}}return n}registerSchema(e,t){if(!e||typeof e!="string")throw new Error("Invalid key: must be non-empty string");if(!t||typeof t!="object")throw new Error("Invalid schema: must be object");this.schemas.set(e,t),this.config.debugMode&&console.log(`\u{1F4CB} Registered validation schema for key: ${e}`,t)}isExtensionContextValid(){try{return!(typeof chrome>"u"||!chrome.storage||!chrome.storage.sync||!chrome.storage.local||!chrome.runtime||!chrome.runtime.id)}catch{return!1}}async attemptChromeStorage(e,t,r,n=!1){let s="";for(let a=0;a<=this.config.maxRetries;a++)try{if(!this.isExtensionContextValid()){s="Extension context is invalid - chrome.storage unavailable",this.config.debugMode&&console.warn(`\u26A0\uFE0F Attempt ${a+1}: ${s}`);break}let o=n?chrome.storage.local:chrome.storage.sync,l;switch(e){case"save":return l=await o.set({[t]:r}),this.config.debugMode&&console.log(`\u2705 Chrome storage save successful: ${t}`),{success:!0,data:r,retryCount:a};case"get":l=await o.get([t]);let c=l[t];return this.config.debugMode&&console.log(`\u2705 Chrome storage get successful: ${t}`,c),{success:!0,data:c,retryCount:a};case"remove":return l=await o.remove([t]),this.config.debugMode&&console.log(`\u2705 Chrome storage remove successful: ${t}`),{success:!0,retryCount:a};case"saveBatch":return l=await o.set(r),this.config.debugMode&&console.log("\u2705 Chrome storage batch save successful"),{success:!0,retryCount:a};default:return{success:!1,error:`Unknown operation: ${e}`}}}catch(o){if(s=o instanceof Error?o.message:String(o),this.config.debugMode&&console.warn(`\u26A0\uFE0F Attempt ${a+1} failed for ${e}:${t}:`,s),a<this.config.maxRetries){let l=this.config.useExponentialBackoff?this.config.retryDelayMs*Math.pow(2,a):this.config.retryDelayMs;await this.delay(l)}}return{success:!1,error:s,retryCount:this.config.maxRetries}}validateData(e,t){let r=this.schemas.get(e);if(!r)return{isValid:!0};if(typeof t!="object"||t===null)return{isValid:!1,error:"Data must be object for schema validation"};for(let[n,s]of Object.entries(r)){let a=t[n];if(s.required&&a==null)return{isValid:!1,error:`Required property missing: ${n}`};if(a==null)continue;let o=Array.isArray(a)?"array":typeof a;if(o!==s.type)return{isValid:!1,error:`Property ${n} must be ${s.type}, got ${o}`};if(s.validate&&!s.validate(a))return{isValid:!1,error:`Property ${n} failed custom validation`}}return{isValid:!0}}delay(e){return new Promise(t=>setTimeout(t,e))}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e},this.config.debugMode&&console.log("\u{1F527} StorageManager configuration updated:",this.config)}async getStorageStats(e=!1){try{if(!this.isExtensionContextValid())return{success:!1,error:"Extension context invalid - cannot check storage stats"};let t=e?chrome.storage.local:chrome.storage.sync,r=await t.getBytesInUse(),n=t.QUOTA_BYTES,s=Math.round(r/n*100);return{success:!0,data:{bytesInUse:r,quotaBytes:n,percentUsed:s}}}catch(t){return{success:!1,error:`Failed to get storage stats: ${t}`}}}};console.log("\u{1F680} ReadWise Pro - Content script loaded at:",new Date().toISOString());console.log("\u{1F310} Document ready state:",document.readyState);console.log("\u{1F517} Current URL:",window.location.href);var ce,A,w,$,le=null,B=null;console.log("\u{1F527} Initializing ReadWise modules...");$=new j({debugMode:!0,enableFallback:!0,maxRetries:3});$.registerSchema("user_preferences",{wpm:{type:"number",required:!0,validate:i=>i>=50&&i<=800},theme:{type:"string",required:!1},dailyGoal:{type:"number",required:!1,validate:i=>i>0}});ce=new O;w=new V({dailyWordGoal:2e3},{onSessionStart:i=>{console.log("\u{1F4CA} Reading session started:",i.id),B=i},onSessionEnd:(i,e)=>{console.log("\u{1F4CA} Reading session ended:",i.id,e),B=null},onGoalAchieved:i=>{console.log("\u{1F389} Goal achieved:",i)}},$);A=new U({wpm:225,highlightColor:"#4285f4",progressIndicator:!0,keyboardControls:!0,autoScroll:!0},{onStart:()=>{console.log("\u{1F3AF} Blur mode started"),B&&w.updateSessionProgress({blurModeUsed:!0})},onWordRevealed:(i,e)=>{B&&w.updateSessionProgress({blurModeWords:i+1,completionRate:(i+1)/(A.getStats().totalWords||1)})},onComplete:i=>{console.log("\u2705 Blur mode completed:",i),B&&w.updateSessionProgress({blurModeWords:i.wordsRevealed,completionRate:1})},onStop:()=>{console.log("\u23F9\uFE0F Blur mode stopped")}});console.log("\u2705 All ReadWise modules initialized successfully");var ue=class{constructor(){this.overlays=new Map;this.nextZIndex=1e4}createOverlay(e){console.log("\u{1F4E6} Creating simple DOM overlay:",e.id),this.removeOverlay(e.id);let t=document.createElement("div");return t.id=`webray-overlay-${e.id}`,t.style.cssText=`
      position: fixed;
      left: ${e.position?.x||20}px;
      top: ${e.position?.y||20}px;
      z-index: ${this.nextZIndex++};
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      max-width: 320px;
      cursor: ${e.draggable?"move":"default"};
    `,e.type==="debug"?t.innerHTML=`
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
          <div style="width: 12px; height: 12px; background: #4caf50; border-radius: 50%;"></div>
          <strong>WebRay-M Debug (Sidebar)</strong>
        </div>
        <div style="font-size: 12px; color: #666;">
          Framework: WebRay-M v2.0<br>
          Engine: Simple DOM<br>
          Type: Sidebar Extension<br>
          Page: ${document.title}
        </div>
        <button onclick="this.parentElement.remove()" style="
          margin-top: 8px; padding: 4px 8px; border: 1px solid #ddd; 
          background: #f5f5f5; border-radius: 4px; cursor: pointer;
        ">Close</button>
      `:e.type==="text"?t.innerHTML=`
        <div>${e.content||"Text overlay"}</div>
        <button onclick="this.parentElement.remove()" style="
          margin-top: 8px; padding: 4px 8px; border: 1px solid #ddd; 
          background: #f5f5f5; border-radius: 4px; cursor: pointer;
        ">Close</button>
      `:e.type==="sidebar"&&(t.innerHTML=`
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
          <div style="width: 12px; height: 12px; background: #ff9800; border-radius: 50%;"></div>
          <strong>WebRay-M Sidebar Panel</strong>
        </div>
        <div style="font-size: 12px; color: #666; margin-bottom: 12px;">
          This is a sidebar-style overlay that can contain<br>
          various tools and information panels.
        </div>
        <div style="display: flex; gap: 8px;">
          <button onclick="console.log('Sidebar action 1')" style="
            padding: 6px 12px; border: 1px solid #ddd; 
            background: #2196f3; color: white; border-radius: 4px; cursor: pointer;
          ">Action 1</button>
          <button onclick="console.log('Sidebar action 2')" style="
            padding: 6px 12px; border: 1px solid #ddd; 
            background: #4caf50; color: white; border-radius: 4px; cursor: pointer;
          ">Action 2</button>
        </div>
        <button onclick="this.parentElement.remove()" style="
          margin-top: 8px; padding: 4px 8px; border: 1px solid #ddd; 
          background: #f5f5f5; border-radius: 4px; cursor: pointer; width: 100%;
        ">Close Sidebar</button>
      `),e.draggable&&this.makeDraggable(t),document.body.appendChild(t),this.overlays.set(e.id,t),console.log("\u2705 Simple overlay created successfully"),t}makeDraggable(e){let t=!1,r=0,n=0,s=0,a=0;e.addEventListener("mousedown",o=>{t=!0,r=o.clientX,n=o.clientY;let l=e.getBoundingClientRect();s=l.left,a=l.top,e.style.opacity="0.8"}),document.addEventListener("mousemove",o=>{if(!t)return;let l=o.clientX-r,c=o.clientY-n;e.style.left=s+l+"px",e.style.top=a+c+"px"}),document.addEventListener("mouseup",()=>{t&&(t=!1,e.style.opacity="1")})}removeOverlay(e){let t=this.overlays.get(e);return t&&t.parentNode?(t.parentNode.removeChild(t),this.overlays.delete(e),!0):!1}},X=null;async function He(){return console.log("\u{1F4E6} Using simple DOM overlay system"),X=new ue,!0}(async()=>{try{await He(),window.hasWebRayContentListener||(console.log("\u{1F3AF} Setting up message listener..."),chrome.runtime.onMessage.addListener((i,e,t)=>{if(console.log("\u{1F4E5} Content script received message:",i),i.action==="ping")return t({success:!0,message:"ReadWise Pro content script is active",features:["textAnalysis","blurMode","sessionTracking"],timestamp:Date.now()}),!0;if(i.action==="analyze_text")return(async()=>{try{console.log("\u{1F4CA} Starting text analysis...");let r=await ce.analyzeCurrentPage(i.readingSpeedWPM);r?(le=r,console.log("\u2705 Analysis completed:",r),t({success:!0,analysis:r})):(console.log("\u26A0\uFE0F Page not suitable for analysis"),t({success:!1,error:"Page not suitable for text analysis"}))}catch(r){console.error("\u274C Analysis failed:",r),t({success:!1,error:r instanceof Error?r.message:"Analysis failed"})}})(),!0;if(i.action==="get_cached_analysis")return t({success:!0,analysis:le,timestamp:le?.timestamp||null}),!0;if(i.action==="update_reading_speed"){try{ce.setReadingSpeed(i.wpm),t({success:!0})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to update reading speed"})}return!0}if(i.action==="create_debug_overlay"){try{X.createOverlay({id:i.overlayId,type:"debug",position:i.position,draggable:!0}),t({success:!0})}catch(r){console.error("Debug overlay creation failed:",r),t({success:!1,error:r instanceof Error?r.message:String(r)})}return!0}if(i.action==="create_text_overlay"){try{X.createOverlay({id:i.overlayId,type:"text",content:i.content,position:i.position,draggable:!0}),t({success:!0})}catch(r){console.error("Text overlay creation failed:",r),t({success:!1,error:r instanceof Error?r.message:String(r)})}return!0}if(i.action==="create_sidebar_overlay"){try{X.createOverlay({id:i.overlayId,type:"sidebar",position:i.position,draggable:!0}),t({success:!0})}catch(r){console.error("Sidebar overlay creation failed:",r),t({success:!1,error:r instanceof Error?r.message:String(r)})}return!0}if(i.action==="start_blur_mode")return(async()=>{try{console.log("\u{1F3AF} Starting blur mode...");let r=await A.startBlurMode();t(r?{success:!0,message:"Blur mode started successfully"}:{success:!1,error:"Failed to start blur mode - no suitable content found"})}catch(r){console.error("\u274C Blur mode start failed:",r),t({success:!1,error:r instanceof Error?r.message:"Failed to start blur mode"})}})(),!0;if(i.action==="stop_blur_mode"){try{A.stopBlurMode(),t({success:!0,message:"Blur mode stopped"})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to stop blur mode"})}return!0}if(i.action==="toggle_blur_pause"){try{A.togglePause();let r=A.getStats();t({success:!0,isPaused:r.isPaused,message:r.isPaused?"Blur mode paused":"Blur mode resumed"})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to toggle blur mode"})}return!0}if(i.action==="adjust_blur_speed"){try{let r=i.wpm||225;A.adjustSpeed(r),t({success:!0,wpm:r,message:`Blur mode speed adjusted to ${r} WPM`})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to adjust speed"})}return!0}if(i.action==="get_blur_status"){try{let r=A.getStats(),n=A.getConfig();t({success:!0,stats:r,config:n,isActive:A.isBlurModeActive()})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to get blur status"})}return!0}if(i.action==="start_reading_session")return(async()=>{try{console.log("\u{1F4CA} Starting reading session...");let r=await w.startSession(window.location.href,document.title,i.targetWPM||225);t({success:!0,session:r,message:"Reading session started successfully"})}catch(r){console.error("\u274C Session start failed:",r),t({success:!1,error:r instanceof Error?r.message:"Failed to start session"})}})(),!0;if(i.action==="end_reading_session")return(async()=>{try{let r=await w.endSession(),n=await w.calculateStatistics();t({success:!0,session:r,stats:n,message:"Reading session ended successfully"})}catch(r){console.error("\u274C Session end failed:",r),t({success:!1,error:r instanceof Error?r.message:"Failed to end session"})}})(),!0;if(i.action==="get_session_status"){try{let r=w.getCurrentSession();t({success:!0,session:r,hasActiveSession:!!r})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to get session status"})}return!0}if(i.action==="get_reading_stats")return(async()=>{try{let r=await w.calculateStatistics(),n=await w.getTodayProgress();t({success:!0,stats:r,todayProgress:n})}catch(r){console.error("\u274C Stats retrieval failed:",r),t({success:!1,error:r instanceof Error?r.message:"Failed to get statistics"})}})(),!0;if(i.action==="save_preferences")return(async()=>{try{let r=await $.save("user_preferences",i.preferences);t({success:r.success,fromFallback:r.fromFallback,error:r.error})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to save preferences"})}})(),!0;if(i.action==="load_preferences")return(async()=>{try{let r=await $.get("user_preferences",{wpm:225,theme:"light",dailyGoal:2e3});t({success:r.success,preferences:r.data,fromFallback:r.fromFallback,error:r.error})}catch(r){t({success:!1,error:r instanceof Error?r.message:"Failed to load preferences"})}})(),!0;if(i.action==="demo_action"){console.log("Content script received message:",i.data);let r=document.createElement("div");return r.textContent=`WebRay-M: ${i.data||"Message received!"}`,r.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          `,document.body.appendChild(r),setTimeout(()=>r.remove(),3e3),t({success:!0}),!0}}),window.hasWebRayContentListener=!0,console.log("\u{1F3AF} Message listener registered"),setTimeout(()=>{console.log("\u{1F9EA} Testing content script communication..."),chrome.runtime.sendMessage({action:"content_script_ready"},i=>{console.log("\u{1F7E2} Content script communication test:",i)})},1e3)),console.log("\u2705 Content script initialization completed")}catch(i){console.error("\u274C Content script initialization failed:",i)}})();})();
//# sourceMappingURL=content.js.map
